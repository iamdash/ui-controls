<!DOCTYPE html>
<html class="mdc-typography">

<head>
  <title>UI Controls</title>
  <link rel="stylesheet" href="node_modules/material-components-web/dist/material-components-web.css">
  <!-- build:js -->
  <!-- bower:js -->
  <script src="app/components/jquery/dist/jquery.js"></script>
  <script src="app/components/sightglass/index.js"></script>
  <script src="app/components/rivets/dist/rivets.js"></script>

  <script src="app/components/underscore/underscore.js"></script>
  <!-- endbower -->
  <!-- inject:js -->
  <!-- endinject -->
  <!-- endbuild -->

  <script src="app/js/vendor/jquery.kontrol.js"></script>
  <script src="node_modules/material-components-web/dist/material-components-web.js"></script>
</head>

<body>
  <main id="calculator">
    <div id="page-title" class="bound">
      <h1 class="mdc-typography--display1">Ui controls: { testText }</h1>
    </div>


    <input type="text" rv-value="numVal" class="dial" max="45" min="13">
    <input type="range" rv-value="numVal" id="range-slider">
    <input type="number" rv-value="numVal" id="num-input">
    <h2> { calculatedValue }</h2>
  </main>



  <form>
    <input type="range" name="foo" min="0" max="100">
    <output for="foo" onforminput="value = foo.valueAsNumber;"></output>
  </form>

  <form>
    <input type="range" name="foo" min="0" max="100" style="width: 300px;">
    <output for="foo" onforminput="value = foo.valueAsNumber;"></output>
  </form>



  <script>
                                   var data = {
                                     testText: 'UI Controls',
                                     numVal: 33,
                                     calculatedValue: 0
                                   };


                                   rivets.bind(
                                     document.querySelector('#calculator'), // bind to the element with id "candy-shop"
                                     data
                                   );


                                   function Calculator() {

                                     var _this = this;
                                     var $dial = $('.dial');

                                     this.prevVal = data.numVal;

                                     this.init = function () {

                                       _this.initSliders();
                                        _this.initNumInputs();

                                       $dial.knob({
                                         'displayPrevious': false,
                                         'release': function (v) {
                                           // console.log('dial released and value is ', v)
                                         },
                                         change: function (v) {
                                           console.log('dial value changed to', v);
                                           data.numVal = v;
                                           data.calculatedValue = 'Cal val = ' + v
                                           _this.update(v);
                                         }
                                       })

                                     }

                                     this.update = function (v, shouldAnimate) {
                                       data.testText = v;

                                       if (shouldAnimate) {
                                         $({ animatedVal: _this.prevVal }).animate({ animatedVal: v }, {
                                           duration: 250,
                                           easing: "swing",
                                           step: function () {
                                             $dial.val(Math.ceil(this.animatedVal)).trigger("change");
                                           }
                                         });
                                       } else {
                                         $dial.val(v).trigger('change');
                                       }
                                     }

                                     this.initSliders = function () {
                                       var slider = document.getElementById('range-slider');
                                       slider.onmousedown = function (e) {
                                         _this.prevVal = slider.value;
                                         _this.update(slider.value, true);
                                       }
                                       slider.onchange = function (e) {
                                         _this.update(slider.value, true);
                                       }
                                     }
                                     this.initNumInputs = function () {
                                       var input = document.getElementById('num-input');
                                       input.onfocus = function(){
                                          _this.prevVal = input.value;
                                       }


                                       
                                       input.onkeyup = _.debounce(function (e) {
                                                _this.update(input.value, true);
  
                                             }, 500)
                                         
                                       
                                       input.onchange = function (e) {
                                        //  _this.update(input.value, true);
                                       }
                                     }
                                   }
                                   var calculator = new Calculator();
                                   calculator.init()
  </script>
</body>

</html>